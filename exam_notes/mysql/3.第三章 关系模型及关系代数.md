#### **本章学习目标**
深入理解关系模型的三要素和完整性约束，掌握关系代数的基本运算和组合运用，能够使用关系代数表达式描述复杂的数据查询请求。

---

### **`★ 3.1 关系模型三要素`**

我们在第二章已经接触过数据模型的通用三要素，这里具体到**关系模型**：

1.  **`数据结构`**：**关系（即二维表）**。
    -   **关系/表**：数据的逻辑结构。
    -   **元组**：表中的一行，代表一个实体。
    -   **属性**：表中的一列，代表实体的一个特征。
    -   **域**：属性的取值范围。
    -   **候选码**：能唯一标识一个元组的属性或属性组。
    -   **主码**：被选中的那个候选码。

2.  **`数据操作`**：**查询**和**更新（插入、删除、修改）**。
    -   特点是**集合操作**：操作的对象和结果都是集合（关系）。

3.  **`完整性约束`**：确保数据正确性的规则。详见3.2节。

---

### **`★★ 3.2 关系模型三类完整性约束`**

这是保证数据库中数据质量的铁律。

1.  **`实体完整性`**
    -   **规则**：**主码**的属性值不能取**空值**。
    -   **`通俗理解`**：一张表中的每一行（实体）必须有一个唯一的“身份证号”（主码），这个“身份证号”不能是空的。否则就无法区分不同的实体。
    -   *例如：`学生表`的主码是`学号`，那么任何一条学生记录的`学号`字段都不能为NULL。*

2.  **`参照完整性`**
    -   **规则**：如果属性（或属性组）F是关系R的**外码**，它与关系S的**主码**Ks相对应，则对于R中每个元组在F上的值必须为以下之一：
        -   取**空值**（F的每个属性值均为空）。
        -   等于S中某个元组的**主码值**。
    -   **`通俗理解`**：你填写的“紧急联系人”必须是你通讯录里存在的人，不能随便编一个名字。
    -   *例如：`学生表`中有外码`班号`，引用自`班级表`的主码`班号`。那么`学生表`中某个学生的`班号`，要么为空（表示该生尚未分班），要么必须是`班级表`中已经存在的某个`班号`。*

3.  **`用户定义的完整性`**
    -   **规则**：针对某一具体应用的数据必须满足的语义要求。
    -   **`通俗理解`**：根据业务逻辑自定义的规则。
    -   *例如：学生的`年龄`必须在16到40岁之间；`性别`只能是‘男’或‘女’。*

---

### **3.3 关系数据语言**

-   **关系代数**：用**对关系的运算**来表达查询要求。**`本章重点`**。
-   **关系演算**：用**谓词**来表达查询要求。（如元组关系演算、域关系演算）。
-   **SQL**：**结构化查询语言**，是集DDL、DML、DCL于一体的标准数据库语言。它介于关系代数和关系演算之间，是**实际应用**的语言。

**关系代数是理解SQL底层逻辑的钥匙。**

---

### **`★★★ 3.4 & 3.5 关系的运算 & 用关系代数语言实现数据查询`**

这是本章的**重中之重**，我们将两部分合并讲解。关系运算分为两大类：

#### **一、传统的集合运算（操作于关系的“行”）**

要求参与运算的两个关系必须具有**相同的关系模式**（即属性结构相同）。

| 运算 | 符号 | 含义 | 类比 |
| :--- | :--- | :--- | :--- |
| **`并`** | $R \cup S$ | 由属于R **或** 属于S的元组组成。**自动去重**。 | 数学中的并集 |
| **`差`** | $R - S$ | 由属于R但**不属于**S的元组组成。 | 数学中的差集 |
| **`交`** | $R \cap S$ | 由既属于R **又** 属于S的元组组成。 | 数学中的交集 |
| **`笛卡尔积`** | $R \times S$ | 关系R（m个元组）和S（n个元组）的笛卡尔积是一个(m*n)个元组的新关系。新关系的属性是R和S属性的并集。 | **`难点`**：这是连接操作的基础。想象将R表的每一行都与S表的每一行进行拼接。 |

#### **二、专门的关系运算（核心查询操作）**

1.  **`选择`**
    -   **符号**：$\sigma_F(R)$
    -   **含义**：在关系R中**选择**满足给定条件F的**元组**（行）。
    -   **`通俗理解`**：相当于SQL中的 **`WHERE`** 子句。**从水平方向（行）筛选**。
    -   *例子：查询计算机系的学生。$\sigma_{所在系='计算机系'}(学生)$*

2.  **`投影`**
    -   **符号**：$\Pi_A(R)$
    -   **含义**：从关系R中**投影**出若干属性列A组成新的关系。**自动去除重复行**。
    -   **`通俗理解`**：相当于SQL中的 **`SELECT`** 后面跟指定列。**从垂直方向（列）筛选**。
    -   *例子：查询所有学生的姓名和学号。$\Pi_{学号, 姓名}(学生)$*

3.  **`连接`** 
	- **`核心难点`**
    -   **符号**：$R \bowtie_{A \theta B} S$
    -   **含义**：从两个关系R和S的笛卡尔积中选取属性间满足一定条件（θ）的元组。
    -   **`等值连接`**：连接条件θ为“=”的连接。
    -   **`自然连接`**：一种特殊的等值连接。它要求两个关系中进行比较的**分量必须是同名属性**，并且在结果中**去掉重复的属性列**。**这是最常用的一种连接！**
    -   **`通俗理解`**：相当于SQL中的 **`JOIN`**。自然连接 ≈ `INNER JOIN ... USING(公共列名)`。
    -   *例子：将`学生`表和`选课`表自然连接，得到每个学生及其选修课程的信息。$学生 \bowtie 选课$*

4.  **`除`** 
	- **`最高难度`**
    -   **符号**：$R \div S$
    -   **含义**：适用于“查询...全部的...”这类问题。
    -   **`解题步骤`**：
        1.  找出关系R和S的公共属性，设为Y。
        2.  在R中，不属于Y的属性组为X。
        3.  结果关系包含属性组X。
        4.  一个元组在结果中当且仅当：它在X上的取值，与S在Y上的**所有**组合都出现在R中。
    -   **`经典例子`**：已知`选课(学号, 课程号)`和`课程(课程号)`，查询选修了**全部课程**的学生学号。
        -   **关系代数**：$\Pi_{学号, 课程号}(选课) \div \Pi_{课程号}(课程)$
        -   **SQL对应**：通常需要用双重否定或分组计数来实现，比较绕。这正体现了关系代数的抽象优势。

---

### **综合查询示例**

**查询选修了“数据库”课程的学生的姓名。**

设：学生(学号, 姓名)，课程(课程号, 课程名)，选课(学号, 课程号, 成绩)

**分步推导：**
1.  先找到“数据库”课程的课程号：$\sigma_{课程名='数据库'}(课程)$ -> 得到一个临时关系，假设结果为(CS001)
2.  找到选修了这门课的学号：$\Pi_{学号}(\sigma_{课程号='CS001'}(选课))$
3.  将这些学号与学生表连接，获取姓名：$\Pi_{姓名}(学生 \bowtie \Pi_{学号}(\sigma_{课程号='CS001'}(选课)))$

**或写成一步：**
$\Pi_{姓名}(学生 \bowtie (\Pi_{学号}(\sigma_{课程名='数据库'}(课程 \bowtie 选课))))$

---

### **本章总结与复习建议**

-   **核心约束**：牢记**实体完整性**和**参照完整性**。
-   **核心运算**：必须掌握**选择σ、投影Π、自然连接⋈** 这三个最常用的运算。
-   **核心技能**：学会将**自然语言查询**翻译成**关系代数表达式**。这是检验你是否理解本章的最佳方式。
-   **联系实际**：时刻思考每个关系代数运算对应SQL中的哪个子句（SELECT, FROM, WHERE, JOIN）。
- [Open: Pasted image 20251201164047.png](charts/1d0c318e943532b926d60df3248552aa_MD5.jpg)
![](charts/1d0c318e943532b926d60df3248552aa_MD5.jpg)
