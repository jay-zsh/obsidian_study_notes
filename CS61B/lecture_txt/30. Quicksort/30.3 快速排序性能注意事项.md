
# 30.3 快速排序性能注意事项

托尼·霍尔选择"快速排序"作为这种特定分区排序算法的名称。巧合的是，经验表明快速排序在多数常见场景下是最快的排序算法。

快速排序究竟有多快？要回答这个问题，我们需要统计快速排序中分区操作的次数并计算其复杂度。

在理论时间复杂度分析中，分区操作消耗 $Θ(K)$ 时间，其中 $Θ(K)$ 表示被分区元素的数量。

然而，使快速排序时间复杂度分析复杂化的是：整体运行时间取决于基准点的最终位置。

---

### 最佳情况

例如，当所选基准点始终位于中间时（即分区总是选取数组的中位数元素），可获得最佳运行时间。

在最佳情况下，每层操作的总工作量约为 $O(N)$。首次分区需检查所有 N 个元素以确定其位于基准点的左侧还是右侧；第二层对两个独立子数组（各含 N/2 元素）重复此过程。因此每层工作量均为 $O(N)$。

整体运行时间为 $Θ(NH)$，其中 $H$ = 层数 = $Θ(logN)$。故最佳情况下快速排序的总运行时间为 $Θ(NlogN)$。

---

### 最差情况

当每次分区选择的基准点均位于数组起始位置时，出现最差运行时间。此时每层仍需 $O(N)$ 工作量，但总层数 $H = N$（因每个元素都需作为基准点）。因此最差运行时间为 $Θ(N²)$。

最差情况：$$Θ(N²)$$

---

### 快速排序与归并排序性能对比

| 理论分析     | 快速排序       | 归并排序       |
| -------- | ---------- | ---------- |
| **最佳情况** | $Θ(NlogN)$ | $Θ(NlogN)$ |
| **最差情况** | $Θ(N²)$    | $Θ(NlogN)$ |

相较而言，归并排序似乎更具优势，因为快速排序的理论最差运行时间为 $Θ(N²)$。那么为何经验表明快速排序最快？其优势在于平均情况下快速排序的时间复杂度为 $Θ(NlogN)$。

---

### 快速排序性能论证1：10%边界情况

支持快速排序经验最优的论点假设：基准点最终位置始终距离数组任一端至少10%。

![](55de199a2b8dc569a2d526b29d75d159_MD5.jpg)

若满足此条件，运行时间仍为 $O(NH)$，其中 $O(N)$ 为每层工作量，H 为总层数。因基准点始终距离边界至少10%，故 $H ≈ log₁₀/₉N = O(log N)$。因此整体运行时间为 $O(N log N)$。

![](4b6d89b07661ff46a2c1a5e03c6ab313_MD5.jpg)

换言之，即使基准点不位于正中，只要保证其始终距离边界10%，运行时间仍为 $O(N log N)$。

---

### 快速排序性能论证2：快速排序即BST排序

从另一视角看，快速排序可视为二叉搜索树（BST）排序的变体。因为快速排序在每次分区中比较元素与基准点的操作，等同于BST插入时的比较操作。

![](c8053c467ef5ac1f4b456fcb26441ec7_MD5.jpg)

![](195cc12c2a9dd64fae2796cdc4e46421_MD5.jpg)

由于随机插入BST需要 $O(N log N)$ 时间，可论证快速排序具有相似性能。

---

### 快速排序经验运行时间

经验表明（N=1000时进行10,000次试验），快速排序平均使用 ~2N ln N 次比较完成排序。

---

### 避免快速排序的最差情况

如上所述，快速排序的性能（包括增长阶数和常数因子）关键取决于：  
**基准点选择策略、围绕基准点的分区实现方式、以及可添加的优化措施。**

特定条件下快速排序可能达到 $Θ(N²)$，远差于 $Θ(NlogN)$。这些条件包括：  
- **不良顺序**：数组已排序或接近有序  
- **不良元素**：数组元素全为重复值
