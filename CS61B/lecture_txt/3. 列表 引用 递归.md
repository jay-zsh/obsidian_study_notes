## 海象之谜（The Mystery of the Walrus）

### 核心代码演示

```java
// 引用类型示例
Walrus a = new Walrus(1000, 8.3);
Walrus b = a;
b.weight = 5; // 修改会影响a的属性

// 基本类型示例
int x = 5;
int y = x;
x = 2; // 修改不会影响y的值
```

### 内存行为对比表

|特征|基本类型 (Primitive)|引用类型 (Reference)|
|---|---|---|
|存储内容|直接存储数值|存储对象内存地址|
|赋值方式|值拷贝|地址拷贝|
|默认值|0/false|null|
|内存占用|固定大小（如int=32bit）|64位地址指针|

![对象共享内存示意图](https://cs61b-2.gitbook.io/~gitbook/image?url=https%3A%2F%2Fjoshhug.gitbooks.io%2Fhug61b%2Fcontent%2Fchap2%2Ffig21%2Fmystery_of_the_walrus_resolved_step3.png&width=768&dpr=4&quality=100&sign=d699b4f9&sv=2)

---

## 内存模型基础

### 变量存储原理

```java
int num = 42;         // 32位存储数值
String str = "Hello"; // 64位存储对象地址
```

### 黄金赋值法则（GRoE）

```java
int a = 5;    // 将二进制0101存入内存
int b = a;    // 复制32位数据

Walrus w1 = new Walrus();  
Walrus w2 = w1; // 复制64位地址
```

![基本类型内存分配](https://cs61b-2.gitbook.io/~gitbook/image?url=https%3A%2F%2Fjoshhug.gitbooks.io%2Fhug61b%2Fcontent%2Fchap2%2Ffig21%2Fx_and_y_simplified_box_notation.png&width=768&dpr=4&quality=100&sign=d12dfa7c&sv=2)

---

## 引用类型详解

### 对象实例化流程

```java
public class Walrus {
    int weight;     // 32位
    double tuskSize; // 64位
    
    public Walrus(int w, double ts) {
        weight = w;
        tuskSize = ts;
    }
}
```

### 空引用处理

```java
Walrus w = null;  
if (w != null) {
    w.weight = 100; // 避免NullPointerException
}
```

---

## 参数传递机制

### 值传递本质

```java
public static void main(String[] args) {
    Walrus walrus = new Walrus(3500, 10.5);
    modify(walrus); // 传递地址拷贝
}

public static void modify(Walrus w) {
    w.weight -= 100; // 修改堆内存对象
    w = null;        // 仅影响局部变量
}
```

---

## 数组操作

### 数组创建与比较

```java
int[] arr1 = {1,2,3};
int[] arr2 = arr1.clone();

System.out.println(arr1 == arr2);          // false (地址比较)
System.out.println(Arrays.equals(arr1, arr2)); // true (内容比较)
```

### ”\=\=’ vs “equals()”对比表

|操作符|比较内容|时间复杂度|
|---|---|---|
|==|内存地址|O(1)|
|Arrays.equals|数组内容|O(n)|

---

## 链表实现（IntList）

### 基础结构

```java
public class IntList {
    public int first;
    public IntList rest;
    
    public IntList(int f, IntList r) {
        first = f;
        rest = r;
    }
}
```

### 方法实现对比表

|方法|实现方式|时间复杂度|代码示例|
|---|---|---|---|
|递归size()|链式调用|O(n)|`if (rest == null) return 1; return 1 + this.rest.size();`|
|迭代size()|while循环|O(n)|`while (p != null) { totalSize++; p = p.rest; }`|
|get()|索引遍历|O(n)|`for (int i=0; i<index; i++) p = p.rest; return p.first;`|

---

## 关键概念总结

1. **黄金赋值法则**  
    所有赋值操作（`=`）都是比特位的直接复制
    
2. **引用本质**
    
    ```java
    Walrus a = new Walrus();
    Walrus b = a; // 两个遥控器控制同一台电视
    ```
    
3. **方法参数特性**
    
    ```java
    void modifyObject(Walrus w) {
        w.weight = 100; // 修改实际对象
        w = null;       // 仅影响局部变量
    }
    ```
    
4. **链表操作原则**
    
    ```java
    // 安全遍历模板
    public void traverse(IntList node) {
        while (node != null) {
            System.out.println(node.first);
            node = node.rest;
        }
    }
    ```
    
5. **数组比较原则**
    
    ```java
    // 正确的内容比较方式
    Arrays.equals(arr1, arr2);
    ```