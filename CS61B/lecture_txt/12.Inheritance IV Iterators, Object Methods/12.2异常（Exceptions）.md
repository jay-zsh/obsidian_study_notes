# 12.2 异常处理

---

- 本节我们将学习如何抛出异常，以有效处理代码中可能出现的错误。



- 我们在前一节实现的`ArraySet`存在一个小问题。当向ArraySet添加`null`时，会触发NullPointerException。

- 问题根源在于`contains`方法中的`items[i].equals(x)`检查。若`items[i]`的值为null，就会执行`null.equals(x)`从而引发空指针异常。


- 异常会中断程序的正常控制流。实际上我们可以主动抛出自定义异常。在Python中你可能见过使用`raise`关键字实现类似功能。在Java中，异常是对象，我们通过以下格式抛出异常：`throw new ExceptionObject(parameter1, ...)`

- 让我们在用户尝试向`ArraySet`添加null值时抛出异常。我们将抛出`IllegalArgumentException`，该异常接收一个字符串参数作为错误信息。


更新后的`add`方法：

```java
/* 将指定值与指定键关联到当前映射中。
   若键为null则抛出IllegalArgumentException */
public void add(T x) {
    if (x == null) {
        throw new IllegalArgumentException("禁止添加空值");
    }
    if (contains(x)) {
        return;
    }
    items[size] = x;
    size += 1;
}
```

---

既然两种情况下都会触发异常，这种改进有何优势？

1. **掌握程序控制权**：我们可以主动决定在何处终止程序流程  
2. **提供更有价值的异常类型和友好的错误信息**：便于其他开发者理解问题根源

---

不过完全不触发程序崩溃会是更好的解决方案。针对这种情况我们有多种处理方式：

**方案一**：当检测到传入`add`方法的参数为null时，直接跳过添加操作  
**方案二**：修改`contains`方法，添加对`items[i] == null`情况的特殊处理

---

无论选择何种方案，确保使用者明确预期行为至关重要。这正是方法注释等文档资料存在的重要意义。