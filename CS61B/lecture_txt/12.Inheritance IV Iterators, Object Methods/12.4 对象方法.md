# 12.4 对象方法

所有类都继承自顶层的Object类。继承的方法如下：

- `String toString()`
- `boolean equals(Object obj)`
- `Class<?> getClass()`
- `int hashCode()`
- `protected Object clone()`
- `protected void finalize()`
- `void notify()`
- `void notifyAll()`
- `void wait()`
- `void wait(long timeout)`
- `void wait(long timeout, int nanos)`

本章我们将重点探讨前两个方法。通过继承机制，我们可以在自定义类中重写这两个方法以实现所需行为。

---

## toString()

`toString()`方法提供对象的字符串表示形式。`System.out.println()`函数会隐式调用传入对象的此方法并打印返回的字符串。执行`System.out.println(dog)`时，实际执行逻辑如下：

```java
String s = dog.toString()
System.out.println(s)
```

Object类的默认`toString()`方法会打印对象在内存中的地址（十六进制字符串）。ArrayList等类和Java数组都有各自重写的`toString()`方法版本。因此，在测试ArrayList时，错误信息会以友好格式（如(1, 2, 3, 4)）返回列表内容而非内存地址。

对于自定义类（如`ArrayDeque`、`LinkedListDeque`等），若希望以可读格式打印对象，需自行实现`toString()`方法。

以下为`ArraySet`类的实现示例（建议通过Java可视化工具理解代码逻辑）：

```java
import java.util.Iterator;

public class ArraySet<T> implements Iterable<T> {
    // 类实现代码...
    
    @Override
    public String toString() {
        /* 待实现 */
    }

    @Override
    public boolean equals(Object other) {
        /* 待实现 */
    }
    
    // 主方法测试代码...
}
```

**练习 6.4.1**：编写`toString()`方法，使ArraySet的打印格式为包含逗号分隔元素的括号形式，如{1, 2, 3, 4}（注意：该方法应返回字符串）

**基础解法**：

```java
public String toString() {
    String returnString = "{";
    for (int i = 0; i < size; i += 1) {
        returnString += keys[i];
        returnString += ", ";
    }
    returnString += "}";
    return returnString;
}
```

此解法存在效率问题：字符串拼接每次都会创建新对象。假设拼接单个字符耗时1秒，对于包含5个元素的ArraySet，总耗时为1+2+3+4+5+6+7秒。

**优化解法（使用StringBuilder）**：

```java
public String toString() {
    StringBuilder returnSB = new StringBuilder("{");
    for (int i = 0; i < size - 1; i += 1) {
        returnSB.append(items[i].toString());
        returnSB.append(", ");
    }
    returnSB.append(items[size - 1]);
    returnSB.append("}");
    return returnSB.toString();
}
```

---

## equals()

`equals()`与`==`在Java中有本质区别：
- `==`检查对象内存地址是否相同（基本类型比较值，对象类型比较指针）
- `equals()`默认行为与`==`相同，但可通过重写实现自定义相等逻辑

**示例分析**：
```java
Doge fido = new Doge(5, "Fido");
Doge fidoTwin = new Doge(5, "Fido");
Doge fidoRealTwin = fido;
```
- `fido == fidoTwin` → False（不同内存对象）
- `fido == fidoRealTwin` → True（相同指针）

**练习 6.4.4**：为ArraySet实现`equals()`方法（集合相等性定义为元素相同，不考虑顺序）

**实现方案**：
```java
public boolean equals(Object other) {
    if (this == other) return true;
    if (other == null) return false;
    if (other.getClass() != this.getClass()) return false;
    
    ArraySet<T> o = (ArraySet<T>) other;
    if (o.size() != this.size()) return false;
    
    for (T item : this) {
        if (!o.contains(item)) return false;
    }
    return true;
}
```

**Java相等性规则**：
1. 等价关系：
   - 自反性：`x.equals(x)`为真
   - 对称性：`x.equals(y)` ⇨ `y.equals(x)`
   - 传递性：`x.equals(y)` ∧ `y.equals(z)` ⇒ `x.equals(z)`
2. 必须接受Object参数以实现重写
3. 一致性：对象未修改时结果恒定
4. 对null始终返回false

---

> 代码解决方案详见：[ArraySet.java](https://github.com/Berkeley-CS61B/lectureCode-sp23/blob/main/lec11_inheritance4/ArraySet.java)
> 
> 图示说明：![[PANG/890ca91276427c1f39f6e738db5ad6a3_MD5.jpg]]
