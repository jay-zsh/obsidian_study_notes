## 静态类型与动态类型

### `maxDog` 方法签名

```java
public static Dog maxDog(Dog d1, Dog d2) { ... }
```

|代码示例|静态类型|是否编译通过|原因|
|---|---|---|---|
|`Dog md = Dog.maxDog(dogC, dogD);`|Dog|✅|返回类型与声明类型匹配|
|`ShowDog msd = Dog.maxDog(dogC, dogD);`|Dog|❌|需要显式向下转型 `(ShowDog)`，存在运行时风险|

> **关键点**：静态类型由方法返回类型决定，与参数动态类型无关

---

## 动态类型识别

### 代码示例分析

```java
Object o = new Dog("Hammy", "Beagle", 15);
Dog d = new ShowDog("Ammo", "Labrador", 54);
Object[] stuff = new Object[5];
stuff[0] = o;
stuff[1] = d;
stuff[2] = null;
```

|变量/元素|动态类型|
|---|---|
|`o`|Dog|
|`d`|ShowDog|
|`stuff[0]`|Dog|
|`stuff[1]`|ShowDog|
|`stuff[2]`|null|

---

## 继承与接口对比

|特性|`extends` 继承|`implements` 接口实现|
|---|---|---|
|代码复用|继承父类实现|仅方法签名契约|
|多继承|不支持（单继承）|支持多接口实现|
|构造函数|必须调用父类构造器|无构造器概念|
|典型应用场景|"is-a" 关系（Poodle is a Dog）|定义行为契约（Comparable）|

---

## 构造函数问题

### 错误示例

```java
public class Dog {
    public Dog(int weight) { ... }
}

public class Poodle extends Dog {
    public Poodle() {} // ❌ 编译错误：未调用父类构造器
}
```

### 修正方案

#### 方案1：添加父类无参构造

```java
public class Dog {
    public Dog() {} // 新增无参构造器
    public Dog(int weight) { ... }
}
```

#### 方案2：显式调用父类构造器

```java
public class Poodle extends Dog {
    public Poodle() {
        super(15); // 显式调用父类有参构造器
    }
}
```

---

## 类型转换陷阱

### 危险的类型转换

```java
Monkey orangutan = new Monkey("fruitful");
Dog mangotan = ((Dog) ((Animal) orangutan)); // ❗运行时异常
```

#### 类结构

```java
class Animal {}
class Monkey extends Animal {}
class Dog extends Animal {}
```

|转换阶段|结果|
|---|---|
|编译时检查|✅ 语法合法|
|运行时检查|❌ ClassCastException|
|异常信息|`Monkey cannot be cast to Dog`|

> **关键点**：父类引用向下转型需通过 `instanceof` 检查

```java
if (animal instanceof Dog) {
    Dog d = (Dog) animal;
}
```

---

## 继承设计原则总结

1. **Liskov替换原则**  
    子类必须能完全替代父类，不破坏原有逻辑
    
2. **构造器链管理**  
    子类必须通过 `super()` 正确初始化父类状态
    
3. **类型安全转换**  
    向下转型前必须进行 `instanceof` 检查
    
4. **接口隔离原则**  
    优先使用接口定义行为，避免过度继承
    
5. **组合优于继承**  
    当不需要"is-a"关系时，使用组合代替继承
    

```java
// 组合示例
public class Poodle {
    private Dog dog;
    private ShowDog showFeatures;
}
```