# 19.5 容量调整与哈希表性能

---

无论我们的`hashCode()`方法多么优秀，如果哈希表的底层数组容量过小且需要存储大量键值，碰撞概率就会显著增加。因此，当哈希表接近饱和时，必须像`ArrayList`扩容机制那样扩展底层数组容量。

Hug教授的讲座深入解析了容量调整的必要性和实现机制！

---

我们定义**负载因子**作为衡量哈希表填充程度的指标，其计算公式为已插入元素数量与数组物理长度的比值。

![[PANG/e07c4564d942ef94a3d420bc559d6326_MD5.jpg]]

这个关键公式决定了哈希表的扩容时机

---

在哈希表设计中，需预先设定最大允许负载因子阈值。**当新增键值对可能导致当前负载因子超过该阈值时，必须执行容量扩展操作**（通常采用数组容量倍增策略）。Java默认最大负载因子为0.75，该值在数组规模与碰撞概率之间实现了良好平衡。

特别说明：若新增键值对的键已存在于哈希映射中，仅更新对应值而不触发扩容机制。

---

**扩容实例分析**：假设初始数组容量为10且已存储7个元素。这些元素通过`hashCode() % 10`计算索引（确保落在0-9范围内），当前负载因子为7/10=0.7，接近但未达阈值。

当插入第8个元素时，负载因子将升至0.8（8/10）。此时需先扩容至20容量，随后重新计算所有元素的新位置（因索引计算变更为`hashCode() % 20`）。扩容完成后，新负载因子降为8/20=0.4，回归安全阈值之下。

