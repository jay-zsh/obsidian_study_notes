# 3. 引用、递归与列表

---

### 列表

您过去一定使用过列表数据结构。例如在Python中：

```python
L = [3, 5, 6]
L.append(7)
```

虽然Java内置了List类型，但我们暂不直接使用。本章将从头构建自己的列表，同时学习Java的关键特性。

---

### 海象之谜

我们首先通过"海象之谜"开启探索之旅。请预测以下代码的运行结果（提示：Java与Python在此行为一致）：

```java
Walrus a = new Walrus(1000, 8.3);
Walrus b;
b = a;
b.weight = 5;
System.out.println(a);
System.out.println(b);
```

再预测以下代码的运行结果：

```java
int x = 5;
int y;
y = x;
x = 2;
System.out.println("x is: " + x);
System.out.println("y is: " + y);
```

答案可[在此查看](http://cscircles.cemc.uwaterloo.ca/java_visualize/#code=public+class+PollQuestions+%7B%0A+++public+static+void+main%28String%5B%5D+args%29+%7B%0A++++++Walrus+a+%3D+new+Walrus%281000,+8.3%29%3B%0A++++++Walrus+b%3B%0A++++++b+%3D+a%3B%0A++++++b.weight+%3D+5%3B%0A++++++System.out.println%28a%29%3B%0A++++++System.out.println%28b%29%3B++++++%0A%0A++++++int+x+%3D+5%3B%0A++++++int+y%3B%0A++++++y+%3D+x%3B%0A++++++x+%3D+2%3B%0A++++++System.out.println%28%22x+is%3A+%22+%2B+x%29%3B%0A++++++System.out.println%28%22y+is%3A+%22+%2B+y%29%3B++++++%0A+++%7D%0A+++%0A+++public+static+class+Walrus+%7B%0A++++++public+int+weight%3B%0A++++++public+double+tuskSize%3B%0A++++++%0A++++++public+Walrus%28int+w,+double+ts%29+%7B%0A+++++++++weight+%3D+w%3B%0A+++++++++tuskSize+%3D+ts%3B%0A++++++%7D%0A%0A++++++public+String+toString%28%29+%7B%0A+++++++++return+String.format%28%22weight%3A+%25d,+tusk+size%3A+%25.2f%22,+weight,+tuskSize%29%3B%0A++++++%7D%0A+++%7D%0A%7D&mode=edit)。

这个看似微妙的概念对数据结构效率至关重要，深入理解能帮助编写更安全可靠的代码。

---

### 比特位

计算机所有信息都以0/1序列存储于内存中，例如：
- 72 → 01001000
- 205.75 → 01000011 01001101 11000000 00000000
- 字母H → 01001000（同72）
- true值 → 00000001

类型系统决定如何解释比特位。例如：

```java
char c = 'H';
int x = c;
System.out.println(c);  // 输出H
System.out.println(x);   // 输出72
```

Java共有8种基本类型：byte、short、int、long、float、double、boolean、char。

---

### 变量声明（简化模型）

声明变量时，Java分配连续内存块：
- `int x`分配32位
- `double y`分配64位

![[PANG/979d4ff0fa58a99c2dde111e4146a936_MD5.jpg]]

内存地址对程序员透明，这种设计取舍避免了[整类编程错误](http://www.informit.com/articles/article.aspx?p=2246428&seqNum=1)。

赋值操作填充内存块：

![[PANG/5e93847fc08aac15a8a16461aebb5ae2_MD5.jpg]]

---

### 等号黄金法则（GRoE）

解谜关键：`y = x`会将x的比特位完整复制到y。这个法则适用于所有赋值操作：

```java
int x = 5;
int y;
y = x;
x = 2;
// 输出x=2, y=5
```

[可视化演示](http://cscircles.cemc.uwaterloo.ca/java_visualize/#code=public+class+PollQuestions+%7B%0A+++public+static+void+main\(String%5B%5D+args%29+%7B%0A++++++int+x+%3D+5%3B%0A++++++int+y%3B%0A++++++y+%3D+x%3B%0A++++++x+%3D+2%3B%0A++++++System.out.println\(%22x+is%3A+%22+%2B+x%29%3B%0A++++++System.out.println\(%22y+is%3A+%22+%2B+y%29%3B++++++%0A+++%7D%0A%7D&mode=display&curInstr=0)

---

### 引用类型

除基本类型外皆为引用类型（如数组、对象）。声明引用变量时分配64位内存（存储对象地址）：

```java
Walrus someWalrus = new Walrus(1000, 8.3);
```

![[PANG/1ebac7f8c21531acd683b58af6543f8e_MD5.jpg]]

当进行`b = a`赋值时，复制的是地址而非实际对象：

![[PANG/40a411c073cf1c21e738206441378b81_MD5.jpg]]

---

### 参数传递

参数传递同样遵循GRoE（值传递）：

```java
public static double average(double a, double b) {
    a = 10;  // 不影响调用方的x值
    return (a + b)/2;
}
```

---

### 数组实例化

数组变量存储引用地址：

```java
int[] x = new int[]{0, 1, 2, 95, 4};
int[] y = new int[]{0, 1, 2, 95, 4};
System.out.println(x == y);  // false（比较地址）
System.out.println(Arrays.equals(x, y));  // true（比较内容）
```

---

### IntList实现

基础链表实现：

```java
public class IntList {
    public int first;
    public IntList rest;
    
    public IntList(int f, IntList r) {
        first = f;
        rest = r;
    }
}
```

**递归求长度**：
```java
public int size() {
    return (rest == null) ? 1 : 1 + this.rest.size();
}
```

**迭代求长度**：
```java
public int iterativeSize() {
    IntList p = this;
    int count = 0;
    while (p != null) {
        count++;
        p = p.rest;
    }
    return count;
}
```

**获取第i个元素**：
```java
public int get(int i) {
    if (i == 0) return first;
    return rest.get(i - 1);
}
```

---

### 破碎蒲团定律

表面简单的概念需要深入理解，避免[一知半解导致的后期问题](https://mathwithbaddrawings.com/2015/04/08/the-math-ceiling-wheres-your-cognitive-breaking-point/)。如同无法直接控制心跳，但避免了误关闭的风险。

---

**练习3.1.1**：分析以下代码影响：
```java
public static void doStuff(Walrus W, int x) {
    W.weight -= 100;  // 影响原对象
    x -= 5;           // 不影响原int值
}
```

答案：`walrus`的weight属性会被修改，`x`保持不变。因为对象是引用传递，基本类型是值传递。
